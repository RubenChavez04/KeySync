<html>
<head>
<title>main_gui.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #8c8c8c; font-style: italic;}
.s3 { color: #067d17;}
.s4 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main_gui.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">PyQt6.QtCore </span><span class="s0">import </span><span class="s1">Qt</span>
<span class="s0">from </span><span class="s1">PyQt6.QtGui </span><span class="s0">import </span><span class="s1">QColor</span>
<span class="s0">from </span><span class="s1">PyQt6.QtWidgets </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">QMainWindow, QVBoxLayout, QWidget, QGridLayout,</span>
    <span class="s1">QStackedLayout</span>
<span class="s1">)</span>

<span class="s0">from </span><span class="s1">gui_assets.buttons_sliders_etc.page </span><span class="s0">import </span><span class="s1">Page</span>
<span class="s0">from </span><span class="s1">gui_assets.buttons_sliders_etc.shadow_fx </span><span class="s0">import </span><span class="s1">ShadowFX</span>
<span class="s0">from </span><span class="s1">gui_assets.buttons_sliders_etc.title_bar </span><span class="s0">import </span><span class="s1">TitleBar</span>
<span class="s0">from </span><span class="s1">gui_assets.main_window_complete_widgets.side_bar </span><span class="s0">import </span><span class="s1">SideBar</span>
<span class="s0">from </span><span class="s1">gui_assets.main_window_complete_widgets.signal_dispatcher </span><span class="s0">import </span><span class="s1">global_signal_dispatcher</span>
<span class="s0">from </span><span class="s1">gui_assets.main_window_complete_widgets.top_bar </span><span class="s0">import </span><span class="s1">TopBar</span>
<span class="s0">from </span><span class="s1">gui_assets.popups.page_background_selection </span><span class="s0">import </span><span class="s1">ChangePageBackgroundDialog</span>
<span class="s0">from </span><span class="s1">gui_assets.widgets </span><span class="s0">import </span><span class="s1">appearance_widget</span>



<span class="s0">class </span><span class="s1">MainWindow(QMainWindow):</span>
    <span class="s0">def </span><span class="s1">__init__(self):</span>
        <span class="s1">super().__init__()</span>
        <span class="s2">#give our window a title</span>
        <span class="s1">self.setWindowTitle(</span><span class="s3">&quot;KeySync&quot;</span><span class="s1">)</span>
        <span class="s1">self.setContentsMargins(</span><span class="s4">10</span><span class="s1">,</span><span class="s4">10</span><span class="s1">,</span><span class="s4">10</span><span class="s1">,</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s2">#set the window size</span>
        <span class="s1">self.setWindowFlags(Qt.WindowType.FramelessWindowHint)</span>
        <span class="s1">self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground)</span>
        <span class="s1">self.color = QColor(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">150</span><span class="s1">)</span>
        <span class="s1">self.shadow = ShadowFX(self, self.color)</span>
        <span class="s1">side_bar_shadow = ShadowFX(self, self.color)</span>
        <span class="s1">top_bar_shadow = ShadowFX(self, self.color)</span>

        <span class="s2">#central widget for the main window</span>
        <span class="s1">main_window = QWidget(self)</span>
        <span class="s1">main_window.setFixedSize(</span><span class="s4">1265</span><span class="s1">, </span><span class="s4">630</span><span class="s1">)</span>
        <span class="s1">main_window.setGraphicsEffect(self.shadow)</span>
        <span class="s1">main_window.setObjectName(</span><span class="s3">&quot;Container&quot;</span><span class="s1">)</span>
        <span class="s1">main_window.setStyleSheet(</span>
            <span class="s3">&quot;&quot;&quot;#Container { 
                background: qlineargradient( 
                    x1: 0, y1: 0, x2: 0, y2: 1, 
                    stop: 0 #171717, 
                    stop: 1 #2b2d30 
                ); 
                border-radius: 8px; 
            }&quot;&quot;&quot;</span>
        <span class="s1">)</span>
        <span class="s2">#layout for the central widget</span>
        <span class="s1">main_window_layout = QGridLayout()</span>
        <span class="s2">#set margins to zero since spacer items allow for better shadowing</span>
        <span class="s1">main_window_layout.setContentsMargins(</span><span class="s4">10</span><span class="s1">, </span><span class="s4">10</span><span class="s1">, </span><span class="s4">10</span><span class="s1">, </span><span class="s4">10</span><span class="s1">)</span>
        <span class="s2">#set spacing between items</span>
        <span class="s1">main_window_layout.setVerticalSpacing(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">main_window_layout.setHorizontalSpacing(</span><span class="s4">5</span><span class="s1">)</span>

        <span class="s2">#add custom title bar</span>
        <span class="s1">title_bar = TitleBar(self)</span>
        <span class="s1">title_bar_layout = QVBoxLayout() </span><span class="s2">#title bar get its own layout so it spans window properly</span>
        <span class="s1">title_bar_layout.setContentsMargins(</span><span class="s4">0</span><span class="s1">,</span><span class="s4">0</span><span class="s1">,</span><span class="s4">0</span><span class="s1">,</span><span class="s4">0</span><span class="s1">) </span><span class="s2">#set no margins for items to be close to top corners</span>
        <span class="s1">title_bar_layout.setSpacing(</span><span class="s4">0</span><span class="s1">) </span><span class="s2">#no spacing, just one object</span>
        <span class="s1">title_bar_layout.addWidget(title_bar) </span><span class="s2">#add title bar to layout</span>

        <span class="s2">#sidebar widget (Add this on the left of the frame)</span>
        <span class="s1">side_bar = SideBar(self)  </span><span class="s2">#declare sidebar</span>
        <span class="s1">side_bar.setGraphicsEffect(side_bar_shadow) </span><span class="s2">#add sidebar shadow</span>
        <span class="s1">main_window_layout.setColumnStretch(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">)  </span><span class="s2">#set a column stretch so that the sidebar fits</span>
        <span class="s1">main_window_layout.addWidget(side_bar, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s4">1</span><span class="s1">)  </span><span class="s2">#add sidebar to layout</span>

        <span class="s2">#page container for adding multiple pages</span>
        <span class="s1">self.page_container = QStackedLayout()  </span><span class="s2">#create a stacked layout which can be indexed</span>
        <span class="s1">self.page_container.setContentsMargins(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">) </span><span class="s2">#no margins so page fits fully</span>
        <span class="s1">self.pages = [] </span><span class="s2">#a list for pages to be inserted</span>
        <span class="s1">main_window_layout.addLayout(self.page_container, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, alignment=Qt.AlignmentFlag.AlignTop) </span><span class="s2">#add page container to layout</span>

        <span class="s2">#topbar for frame editing</span>
        <span class="s1">self.top_bar = TopBar(self) </span><span class="s2">#call TopBar class</span>
        <span class="s1">self.top_bar.setGraphicsEffect(top_bar_shadow)</span>
        <span class="s1">main_window_layout.setRowStretch(</span><span class="s4">0</span><span class="s1">,</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">main_window_layout.addWidget(self.top_bar, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, alignment=Qt.AlignmentFlag.AlignTop) </span><span class="s2">#add top bar to layout</span>

        <span class="s2">#connect the tabs of the current page</span>
        <span class="s1">self.top_bar.tab_bar.tab_changed.connect(self.switch_or_add_page) </span><span class="s2">#go to switch or add page when state change</span>
        <span class="s1">self.add_new_page() </span><span class="s2">#add a default page</span>

        <span class="s2">#show popup to add widgets</span>
        <span class="s1">global_signal_dispatcher.add_widget_signal.connect(self.show_add_widget_popup)</span>

        <span class="s2">#show popup to change page background</span>
        <span class="s1">global_signal_dispatcher.change_page_background_signal.connect(self.show_background_dialog)</span>
        <span class="s1">global_signal_dispatcher.image_selected_signal.connect(self.update_page_background)</span>

        <span class="s2">#set the layout for the central widget</span>
        <span class="s1">title_bar_layout.addLayout(main_window_layout)</span>
        <span class="s1">main_window.setLayout(title_bar_layout)</span>
        <span class="s1">self.setCentralWidget(main_window)</span>

    <span class="s0">def </span><span class="s1">add_new_page(self):</span>
        <span class="s2">&quot;&quot;&quot;Add a new page to the page container when called&quot;&quot;&quot;</span>
        <span class="s1">page_shadow = ShadowFX(self, self.color) </span><span class="s2">#decalre shadow fx</span>
        <span class="s1">page= Page(self) </span><span class="s2">#set page to page class</span>
        <span class="s1">page.setGraphicsEffect(page_shadow) </span><span class="s2">#add shadow fx</span>
        <span class="s1">self.pages.append(page) </span><span class="s2">#add page to list</span>
        <span class="s1">self.page_container.addWidget(page) </span><span class="s2">#add page to page container</span>

    <span class="s0">def </span><span class="s1">switch_or_add_page(self,index):</span>
        <span class="s2">&quot;&quot;&quot;When a tab is changed or added, switch to page that is indexed with tab, else add a new page&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">index &gt;= len(self.pages): </span><span class="s2">#check if page exists with current amount of tabs</span>
            <span class="s1">self.add_new_page() </span><span class="s2">#add a new page</span>
        <span class="s1">self.page_container.setCurrentWidget(self.pages[index]) </span><span class="s2">#go to page indexed with tab</span>

    <span class="s0">def </span><span class="s1">show_add_widget_popup(self):</span>
        <span class="s2">#get the current page from index and show popup for respective page</span>
        <span class="s1">current_page = self.pages[self.page_container.currentIndex()]</span>
        <span class="s1">current_page.show_add_widget_popup()</span>

    <span class="s0">def </span><span class="s1">show_background_dialog(self):</span>
        <span class="s2">&quot;&quot;&quot;Open the image import dialog.&quot;&quot;&quot;</span>
        <span class="s1">dialog = ChangePageBackgroundDialog()</span>
        <span class="s1">dialog.exec()</span>

    <span class="s0">def </span><span class="s1">update_page_background(self, image_path):</span>
        <span class="s2">&quot;&quot;&quot;Update the background of the current page.&quot;&quot;&quot;</span>
        <span class="s1">current_page = self.pages[self.page_container.currentIndex()]</span>
        <span class="s1">current_page.update_background(image_path)</span>
</pre>
</body>
</html>